<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Nobwak&#39;s Lair  | [FreeBSD] PC-BSDがFreeBSD向けpkg repo作ってくれたけど動かないでござる(2013/4/27現在)</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.54.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="[FreeBSD] PC-BSDがFreeBSD向けpkg repo作ってくれたけど動かないでござる(2013/4/27現在)" />
<meta property="og:description" content="（追記:2013/11/7） 公式のpkgngが公開されている。詳しくは以下を。 ../../../?p=2357 （追記ここまで） FreeBSDの新ソフトウェア管理ツールであ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nobwak.github.io/posts/2013-04-26-freebsd_pc-bsd%E3%81%8Cfreebsd%E5%90%91%E3%81%91pkg_repo%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%9F%E3%81%91%E3%81%A9%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84%E3%81%A7%E3%81%94%E3%81%96%E3%82%8B2013_4_27%E7%8F%BE%E5%9C%A8/" />
<meta property="article:published_time" content="2013-04-26T22:49:10&#43;09:00"/>
<meta property="article:modified_time" content="2013-04-26T22:49:10&#43;09:00"/>

<meta itemprop="name" content="[FreeBSD] PC-BSDがFreeBSD向けpkg repo作ってくれたけど動かないでござる(2013/4/27現在)">
<meta itemprop="description" content="（追記:2013/11/7） 公式のpkgngが公開されている。詳しくは以下を。 ../../../?p=2357 （追記ここまで） FreeBSDの新ソフトウェア管理ツールであ">


<meta itemprop="datePublished" content="2013-04-26T22:49:10&#43;09:00" />
<meta itemprop="dateModified" content="2013-04-26T22:49:10&#43;09:00" />
<meta itemprop="wordCount" content="1098">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[FreeBSD] PC-BSDがFreeBSD向けpkg repo作ってくれたけど動かないでござる(2013/4/27現在)"/>
<meta name="twitter:description" content="（追記:2013/11/7） 公式のpkgngが公開されている。詳しくは以下を。 ../../../?p=2357 （追記ここまで） FreeBSDの新ソフトウェア管理ツールであ"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://nobwak.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Nobwak&#39;s Lair
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">[FreeBSD] PC-BSDがFreeBSD向けpkg repo作ってくれたけど動かないでござる(2013/4/27現在)</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2013-04-26T22:49:10&#43;09:00">April 26, 2013</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>（追記:2013/11/7）<br />
公式のpkgngが公開されている。詳しくは以下を。<br />
<a href="../../../?p=2357" target="_blank">../../../?p=2357</a><br />
（追記ここまで）</p>

<p>FreeBSDの新ソフトウェア管理ツールであるpkgngだが、FreeBSD公式サイトの<a href="https://wiki.freebsd.org/pkgng#Availability_of_pkgs_for_Download" target="_blank">不正アクセス食らったせいで</a>pkgを配布するpackage repositoryが停止されている。</p>

<p>そこで<a href="../../../?p=1947" target="_blank">こんな事を</a>してしのいでいたわけだが、今月の初め、改めてPC-BSDからこのような周知があり、FreeBSDのpkgng使いはこぞって大感謝した。</p>

<p><a href="http://blog.pcbsd.org/2013/04/pc-bsd-announces-package-repository-for-pc-bsd-and-freebsd-9-1-release/" target="_blank">PC-BSD Announces Package Repository for PC-BSD and FreeBSD 9.1</a></p>

<p><a href="http://gihyo.jp/admin/clip/01/fdt/201304/10" target="_blank">FreeBSD PKGngパッケージリポジトリ，iXsystems提供開始</a></p>

<p>ところがここ数日、どうもレポジトリが壊れているようなんである。<br />
曰く、i386用のrepoなのに、amd64のが混じってるぞ、と。<br />
したがって、二週間もすれば対策されるような気もする。</p>

<pre><code class="language-console">$ sudo pkg upgrade
Updating repository catalogue
repo.txz 100% 14MB 791.6KB / s 1.0MB / s 00:18
pkg: At least one of the packages provided by the repository is not compatible with your ABI:
Your ABI: freebsd: 9: x86: 32
Incompatible ABIs found: freebsd: 9: x86: 64
</code></pre>

<p>しかし二週間も待ってられない。ググったら<a href="http://debuntu.info/note/pkgng-32bit-repository-error-upgrade" target="_blank">対策</a>が出てきた。<br />
ここにメモしとく。</p>

<h3 id="span-style-text-decoration-underline-repo-sqlite-レポジトリカタログ-をローカルで修正する-span"><span style="text-decoration: underline;">repo.sqlite（レポジトリカタログ）をローカルで修正する。</span></h3>

<p>レポジトリカタログとは、そのレポジトリ（ftp.pcbsd.org）にあるpkgの情報を一覧にしたもの。<br />
レポジトリの修正はできないから、レポジトリカタログを修正する。<br />
すなわち、カタログからamd64向けのものを削除するわけ。</p>

<p>まずはrepo.txzをダウンロードする。</p>

<pre><code class="language-console">$ fetch http://ftp.pcbsd.org/pub/mirror/packages/9.1-RELEASE/i386/repo.txz
repo.txz 32% of 13 MB 230 kBps 00m42s
</code></pre>

<p>txzをtarで展開して、sqlite3で開く。<br />
packagsテーブルをサーチしてみると、wineが悪さをしていることが分かる。</p>

<pre><code class="language-console">$ sqlite3 ./repo.sqlite
sqlite&gt; .tables

categories licenses packages pkg_licenses shlibs
deps options pkg_categories pkg_shlibs
sqlite&gt; select * from packages where arch=&quot;freebsd:9:x86:64&quot;;

11394|emulators/i386-wine-devel|i386-wine|1.5.27,1|Microsoft Windows compatibility environment|Wine is a Microsoft Windows compatibility layer (or program loader)
capable of running Windows applications on i386 and compatible CPUs.
Windows programs running in Wine act as native programs would, running
without the performance or memory usage penalties of an emulator, with
a similar look and feel to other applications on your desktop.

Many applications already work, more or less, including versions of
Microsoft Office and several games.

WWW: http://www.winehq.org/

Gerald Pfeifer &lt;gerald@FreeBSD.org&gt;||freebsd:9:x86:64|gerald@FreeBSD.org|http://www.winehq.org/|/usr/local|18801412|144704625|124|36710abf23920911a3fb2bdd34ab8643b55d6f5a1f4a3ba565c0edf4229a101d|All/i386-wine-1.5.27,1.txz|
</code></pre>

<p>たしかに「freebsd:9:x86:64」とありますな。<br />
そして当該行を削除。</p>

<pre><code class="language-console">sqlite&gt; delete from packages where arch=&quot;freebsd:9:x86:64&quot;;
sqlite&gt; select * from packages where arch=&quot;freebsd:9:x86:64&quot;;
sqlite&gt;

sqlite&gt; .quit
</code></pre>

<p>これで修正はおしまい。</p>

<h3 id="span-style-text-decoration-underline-修正したrepoでアップデートを試みる-span"><span style="text-decoration: underline;">修正したrepoでアップデートを試みる。</span></h3>

<p>そうしてできたカタログをローカルの/var/db/pkg/へ移す。<br />
まずもともとのカタログを消す。</p>

<pre><code class="language-console">$ cd /var/db/pkg.
$ ls repo*
repo.sqlite repo.sqlite.unchecked
$ sudo rm repo.*
$
</code></pre>

<p>修正済みのカタログを移す。</p>

<pre><code class="language-console">$ sudo cp ./repo.sqlite /var/db/pkg/
$
</code></pre>

<p>そうしたら、あとは-Uオプションを付けて実行するだけ。</p>

<p>-Uオプションはrepoカタログの更新をスキップするもの。</p>

<pre><code class="language-console">-U Skip updating the repository catalogues with pkg-update (8). Use the
local cache only. pkg upgrade will always print out the list of
packages with available updates.
</code></pre>

<pre><code class="language-console">$ sudo pkg upgrade -U

The following packages will be upgraded:

Upgrading libiconv: 1.14 -&gt; 1.14_1
Upgrading gettext: 0.18.1.1 -&gt; 0.18.1.1_1
Upgrading perl: 5.14.2_2 -&gt; 5.14.2_3
Upgrading pkgconf: 0.8.9 -&gt; 0.9.1_2
Upgrading libffi: 3.0.12 -&gt; 3.0.13
</code></pre>

<p>無事にできました。<br />
うっかり-Uを付け忘れて、カタログが上書きされちゃったら、もう一回やればOK。</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nobwak.github.io/" >
    &copy; 2019 Nobwak&#39;s Lair
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
