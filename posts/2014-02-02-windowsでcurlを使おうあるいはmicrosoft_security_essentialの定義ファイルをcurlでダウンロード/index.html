<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Nobwak&#39;s Lair  | Windowsでcurlを使おう。あるいはMicrosoft Security Essentialの定義ファイルをcurlでダウンロード。</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.54.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Windowsでcurlを使おう。あるいはMicrosoft Security Essentialの定義ファイルをcurlでダウンロード。" />
<meta property="og:description" content="Windowsでもバッチファイルでファイルのダウンロードをしたい事がある。 そうすると、たとえばIEにURLを渡して起動するといったような事が" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nobwak.github.io/posts/2014-02-02-windows%E3%81%A7curl%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86%E3%81%82%E3%82%8B%E3%81%84%E3%81%AFmicrosoft_security_essential%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92curl%E3%81%A7%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89/" />
<meta property="article:published_time" content="2014-02-02T20:00:47&#43;09:00"/>
<meta property="article:modified_time" content="2014-02-02T20:00:47&#43;09:00"/>

<meta itemprop="name" content="Windowsでcurlを使おう。あるいはMicrosoft Security Essentialの定義ファイルをcurlでダウンロード。">
<meta itemprop="description" content="Windowsでもバッチファイルでファイルのダウンロードをしたい事がある。 そうすると、たとえばIEにURLを渡して起動するといったような事が">


<meta itemprop="datePublished" content="2014-02-02T20:00:47&#43;09:00" />
<meta itemprop="dateModified" content="2014-02-02T20:00:47&#43;09:00" />
<meta itemprop="wordCount" content="1412">



<meta itemprop="keywords" content="Windows," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Windowsでcurlを使おう。あるいはMicrosoft Security Essentialの定義ファイルをcurlでダウンロード。"/>
<meta name="twitter:description" content="Windowsでもバッチファイルでファイルのダウンロードをしたい事がある。 そうすると、たとえばIEにURLを渡して起動するといったような事が"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://nobwak.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Nobwak&#39;s Lair
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Windowsでcurlを使おう。あるいはMicrosoft Security Essentialの定義ファイルをcurlでダウンロード。</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2014-02-02T20:00:47&#43;09:00">February 2, 2014</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>Windowsでもバッチファイルでファイルのダウンロードをしたい事がある。<br />
そうすると、たとえばIEにURLを渡して起動するといったような事が考えられるが、いちいち保存を選ばないといけないとか、何かの操作が必要になってしまう。<br />
これではバッチファイルの意味がない。<br />
無人で行う方法にはいくつかあるだろうが、ここではcurlを使ってみる。</p>

<h2 id="span-style-text-decoration-underline-curlとは-span"><span style="text-decoration: underline;">curlとは</span></h2>

<p>curlとは、URLを使った、データ送受信コマンドである。<br />
<span style="line-height: 1.5em;">UNIX/Linux系では有名なコマンドだけれども、実はWindows向けバイナリも配布されている。</span></p>

<p>公式サイト<br />
<a href="http://curl.haxx.se/" target="_blank"><a href="http://curl.haxx.se/">http://curl.haxx.se/</a></a><br />
Wikipedia<br />
<a href="http://curl.haxx.se/" target="_blank"><a href="http://ja.wikipedia.org/wiki/CURL">http://ja.wikipedia.org/wiki/CURL</a></a></p>

<h2 id="span-style-text-decoration-underline-インストール-span"><span style="text-decoration: underline;">インストール</span></h2>

<p>上記サイトのダウンロードページから取得。<br />
<a href="http://curl.haxx.se/download.html" target="_blank"><a href="http://curl.haxx.se/download.html">http://curl.haxx.se/download.html</a></a></p>

<p>Windows向けには32bit版, 64bit版のほか、Generic版, MSVC版がある。<br />
さらにMSIとzipが選べる。</p>

<p>Genericの方が最新なのでこちらを使った。2014/1/7現在のバージョンは7.34.0。<br />
Windows7だけど2000/XPのもので問題なし。</p>

<p>インストーラは使いたくないのであれば、MSIではなくzipの方でどうぞ。<br />
ただしzipの場合は、PATHを通すなどの作業は自分でしないといけないよう。</p>

<h2 id="span-style-text-decoration-underline-curlの使い方-span"><span style="text-decoration: underline;">curlの使い方</span></h2>

<p>curlはオプションが多くてウンザリする。<br />
以下のサイトが適切な量にまとまっていると思う。</p>

<p><a href="http://d.hatena.ne.jp/hogem/20091122/1258863440" target="_blank"><a href="http://d.hatena.ne.jp/hogem/20091122/1258863440">http://d.hatena.ne.jp/hogem/20091122/1258863440</a></a></p>

<h2 id="span-style-text-decoration-underline-curlの使い方例-span"><span style="text-decoration: underline;">curlの使い方例</span></h2>

<p>proxy越しにMicrosoft Security Essential定義ファイルのダウンロードをする例。</p>

<pre><code class="language-console">C:¥home¥tools¥curl&gt;curl -O -x this.is.sample.proxyserver.com:8080 &quot;http://download.microsoft.com/download/DefinitionUpdates/mpam-fe.exe&quot;
</code></pre>

<p>curlは、そのままだとダウンロードした内容を標準出力に表示する。<br />
-Oを付けると、ダウンロード先のファイル名で保存する。<br />
この場合だとmpam-fe.exeとして保存する。</p>

<p>proxyサーバは、-xあるいは-proxyで指定する。<br />
書式は&lt;[protocol://][user:password@]proxyhost[:port]&gt;</p>

<p>プロトコル指定がなければHTTP proxyとして扱われる。<br />
ポート番号については、指定がなければ1080として扱われる。</p>

<p>例ではproxyサーバとしてthis.is.sample.proxyserver.com:8080を指定。<br />
定義ファイルのダイレクトリンクとして <a href="http://download.microsoft.com/download/DefinitionUpdates/mpam-fe.exe">http://download.microsoft.com/download/DefinitionUpdates/mpam-fe.exe</a> を指定している（いつまで使えるかは分からない）</p>

<h2 id="追記-リトライ数-リトライ感覚の指定">追記: リトライ数、リトライ感覚の指定</h2>

<p>サーバの反応が悪く、ダウンロード途中で失敗してしまうことがある。<br />
そういう場合には、-retry <num> -retry-delay <sec>を指定しておこう。</p>

<h2 id="span-style-text-decoration-underline-curlのman抜粋-span"><span style="text-decoration: underline;">curlのman抜粋</span></h2>

<p>以下、-xと-Oのマニュアルを抜粋。</p>

<pre><code class="language-console">-x, --proxy &lt;[protocol://][user:password@]proxyhost[:port]&gt;

Use the specified proxy. 

The proxy string can be specified with a protocol:// prefix to specify alternative proxy protocols. Use socks4://, socks4a://, socks5:// or socks5h:// to request the specific SOCKS version to be used. No protocol specified, http:// and all others will be treated as HTTP proxies. (The protocol support was added in curl 7.21.7)

If the port number is not specified in the proxy string, it is assumed to be 1080.

This option overrides existing environment variables that set the proxy to use. If there's an environment variable setting a proxy, you can set proxy to &quot;&quot; to override it.

All operations that are performed over an HTTP proxy will transparently be converted to HTTP. It means that certain protocol specific operations might not be available. This is not the case if you can tunnel through the proxy, as one with the -p, --proxytunnel option.

User and password that might be provided in the proxy string are URL decoded by curl. This allows you to pass in special characters such as @ by using %40 or pass in a colon with %3a.

The proxy host can be specified the exact same way as the proxy environment variables, including the protocol prefix (http://) and the embedded user + password.

If this option is used several times, the last one will be used.
</code></pre>

<p>``` console
-O, &ndash;remote-name</p>

<p>Write output to a local file named like the remote file we get. (Only the file part of the remote file is used, the path is cut off.)</p>

<p>The remote file name to use for saving is extracted from the given URL, nothing else.</p>

<p>Consequentially, the file will be saved in the current working directory. If you want the file saved in a different directory, make sure you change current working directory before you invoke curl with the -O, &ndash;remote-name flag!</p>

<p>There is no URL decoding done on the file name. If it has %20 or other URL encoded parts of the name, they will end up as-is as file name.</p>

<p>You may use this option as many times as the number of URLs you have.```</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/windows" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Windows</a>
   </li>
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/2014-01-26-windows7%E3%81%A7samba%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E3%81%86%E3%81%BE%E3%81%8F%E9%96%8B%E3%81%91%E3%81%AA%E3%81%84%E4%BB%B6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6oplocks%E6%AD%BB%E3%81%99%E3%81%B9%E3%81%97/">Windows7でsambaのファイルがうまく開けない件について（oplocks死すべし）</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2013-12-27-python%E3%81%A7windows%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86/">PythonでWindowsアプリケーションを作ってみよう</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nobwak.github.io/" >
    &copy; 2019 Nobwak&#39;s Lair
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
