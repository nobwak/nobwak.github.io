<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Nobwak&#39;s Lair  | [Windows][バッチ][メモ] EFSをコマンドラインから操作する。</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.54.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="[Windows][バッチ][メモ] EFSをコマンドラインから操作する。" />
<meta property="og:description" content="EFSとは、Windowsの暗号化機能。 使用するとファイル名とかフォルダ名とかが緑になるアレな。 以下、Microsoftのサイトより。 http://windows.microsoft.com/ja-jp/windows/what-is-encrypting-file-system#1TC=windows-7 暗号" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nobwak.github.io/posts/2014-08-22-windows%E3%83%90%E3%83%83%E3%83%81%E3%83%A1%E3%83%A2_efs%E3%82%92%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%8B%E3%82%89%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B/" />
<meta property="article:published_time" content="2014-08-22T19:57:41&#43;09:00"/>
<meta property="article:modified_time" content="2014-08-22T19:57:41&#43;09:00"/>

<meta itemprop="name" content="[Windows][バッチ][メモ] EFSをコマンドラインから操作する。">
<meta itemprop="description" content="EFSとは、Windowsの暗号化機能。 使用するとファイル名とかフォルダ名とかが緑になるアレな。 以下、Microsoftのサイトより。 http://windows.microsoft.com/ja-jp/windows/what-is-encrypting-file-system#1TC=windows-7 暗号">


<meta itemprop="datePublished" content="2014-08-22T19:57:41&#43;09:00" />
<meta itemprop="dateModified" content="2014-08-22T19:57:41&#43;09:00" />
<meta itemprop="wordCount" content="4424">



<meta itemprop="keywords" content="BATCH,Windows," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Windows][バッチ][メモ] EFSをコマンドラインから操作する。"/>
<meta name="twitter:description" content="EFSとは、Windowsの暗号化機能。 使用するとファイル名とかフォルダ名とかが緑になるアレな。 以下、Microsoftのサイトより。 http://windows.microsoft.com/ja-jp/windows/what-is-encrypting-file-system#1TC=windows-7 暗号"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://nobwak.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Nobwak&#39;s Lair
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">[Windows][バッチ][メモ] EFSをコマンドラインから操作する。</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2014-08-22T19:57:41&#43;09:00">August 22, 2014</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>EFSとは、Windowsの暗号化機能。<br />
使用するとファイル名とかフォルダ名とかが緑になるアレな。</p>

<p>以下、Microsoftのサイトより。</p>

<p><a href="http://windows.microsoft.com/ja-jp/windows/what-is-encrypting-file-system#1TC=windows-7" target="_blank"><a href="http://windows.microsoft.com/ja-jp/windows/what-is-encrypting-file-system#1TC=windows-7">http://windows.microsoft.com/ja-jp/windows/what-is-encrypting-file-system#1TC=windows-7</a></a></p>

<p>暗号化ファイル システム (EFS) は、情報をハード ディスク上に暗号化された形式で格納するための Windows の機能です。暗号化は、情報のセキュリティを保護するために Windows が提供する最も強力な保護手段です。</p>

<blockquote>
<p>EFS の主な機能の一部を紹介します。</p>

<p>暗号化が簡単です。ファイルまたはフォルダーのプロパティのチェック ボックスをオンにするだけで有効になります。<br />
ファイルを読むことができるユーザーを制限できます。<br />
ファイルは閉じたときに暗号化されますが、開くときに自動的に使用できる状態になります。<br />
ファイルの暗号化を解除する場合は、ファイルのプロパティでチェック ボックスをオフにします。</p>

<p>EFS は、Windows 7 Starter、Windows 7 Home Basic、および Windows 7 Home Premium では完全にはサポートされていません。</p>
</blockquote>

<p>末文に注意。Professional以上ということですな。</p>

<h2 id="使いかた">使いかた</h2>

<p>crypt /?で使い方が表示される。長いので本記事末尾に示す。</p>

<h2 id="ファイルを暗号化-復号する">ファイルを暗号化、復号する。</h2>

<p>暗号化はcipher /e ＜ファイル名＞、復号にはcipher /d ＜ファイル名＞と指定する。<br />
Encrypt, Decrypt、ですな。<br />
以下、ひみつ.txtを暗号化する例。</p>

<pre><code class="language-console">c:¥&gt;cipher /e c:¥vault¥crypt¥ひみつ.txt

 c:¥vault¥crypt¥ のファイルを暗号化しています

ひみつ.txt             [OK]

1 ディレクトリ内の 1 ファイル [またはディレクトリ] が暗号化されました。

ファイルをプレーンテキストから暗号化テキストに変換すると、
ディスク ボリュームに古いプレーンテキストの部分が残る場合があります。
変換がすべて完了してから、コマンド CIPHER /W:ディレクトリを使って
ディスクをクリーンアップすることをお勧めします。

c:¥&gt;cipher /d c:¥vault¥crypt¥ひみつ.txt

 c:¥vault¥crypt¥ のファイルの暗号化を解除しています

ひみつ.txt             [OK]

1 ディレクトリ内の 1 ファイル [またはディレクトリ] の暗号化が解除されました。
</code></pre>

<p>簡単ですな。</p>

<h2 id="ワイルドカードも使用可能">ワイルドカードも使用可能</h2>

<p>ファイルの指定にはワイルドカードが使える。</p>

<pre><code class="language-console">c:¥&gt;cipher /e c:¥vault¥crypt¥*.txt

 c:¥vault¥crypt¥ のファイルを暗号化しています

とてもひみつ.txt          [OK]
ひみつ.txt             [OK]

1 ディレクトリ内の 2 ファイル [またはディレクトリ] が暗号化されました。

c:¥&gt;cipher /d c:¥vault¥crypt¥*.txt

 c:¥vault¥crypt¥ のファイルの暗号化を解除しています

とてもひみつ.txt          [OK]
ひみつ.txt             [OK]

1 ディレクトリ内の 2 ファイル [またはディレクトリ] の暗号化が解除されました。
</code></pre>

<p>これもまあ、普通。</p>

<h2 id="ディレクトリの暗号化-復号">ディレクトリの暗号化、復号</h2>

<p>ファイルではなくディレクトリを指定することもできる。<br />
この場合、「それ以降に」当該ディレクトリに置かれるファイルが暗号化されるか/されないかが決まる。<br />
もともと置いてあったファイルには影響しない。</p>

<pre><code class="language-console">C:¥&gt;cipher /e c:¥vault¥crypt¥

 新しいファイルを暗号化するようにディレクトリ c:¥vault¥crypt¥ を設定
しています [OK]

1 ディレクトリ内の 1 ファイル [またはディレクトリ] が暗号化されました。


C:¥&gt;cipher /d c:¥vault¥crypt¥

 新しいファイルを暗号化しないようにディレクトリ c:¥users¥0066945¥out¥crypt¥ を設
定しています [OK]

1 ディレクトリ内の 1 ファイル [またはディレクトリ] の暗号化が解除されました。
</code></pre>

<h2 id="フォルダ配下全部を暗号化-復号">フォルダ配下全部を暗号化/復号</h2>

<p>/s:に続けてディレクトリを指定すると、再帰的な処理ができる。</p>

<pre><code class="language-console">c:¥&gt;cipher /e /s:c:¥vault¥crypt

 新しいファイルを暗号化するようにディレクトリ c:¥vault¥crypt を設定
しています [OK]

 c:¥vault¥crypt¥ のファイルを暗号化しています

ひみつ.txt             [OK]

2 ディレクトリ内の 2 ファイル [またはディレクトリ] が暗号化されました。


c:¥&gt;cipher /d /s:c:¥vault¥crypt

 新しいファイルを暗号化しないようにディレクトリ c:¥vault¥crypt を設
定しています [OK]

 c:¥vault¥crypt¥ のファイルの暗号化を解除しています

ひみつ.txt             [OK]

2 ディレクトリ内の 2 ファイル [またはディレクトリ] の暗号化が解除されました。
</code></pre>

<h2 id="状態確認">状態確認</h2>

<p>暗号化されているか/されていないかは、ファイル名の色で判断できる。<br />
緑色なら暗号化されていて、黒なら暗号化されていない。<br />
もちろん、コマンドからも確認できる。<br />
オプション指定なくファイル名、ディレクトリ名を渡せば暗号化状況を得られる。</p>

<pre><code class="language-console">c:¥&gt;cipher c:¥vault¥crypt

 c:¥vault¥ の一覧を作成しています
 このディレクトリに追加されるファイルは暗号化されません。

E crypt

c:¥&gt;cipher c:¥vault¥crypt¥ひみつ.txt

 c:¥vault¥crypt¥ の一覧を作成しています
 このディレクトリに追加される新しいファイルは暗号化されます。

E ひみつ.txt
</code></pre>

<p>もちろん、再帰オプションも使用可能。</p>

<pre><code class="language-console">c:¥&gt;cipher /s:c:¥vault¥crypt¥

 c:¥users¥0066945¥out¥crypt¥ の一覧を作成しています
 このディレクトリに追加される新しいファイルは暗号化されます。

E とてもひみつ.txt
U ひみつ.txt
</code></pre>

<h2 id="ヘルプ">ヘルプ</h2>

<p>``` console
c:¥&gt;cipher /?
NTFS パーティション上のディレクトリ [ファイル] の暗号化を表示または変更します。</p>

<p>CIPHER [/E | /D | /C]
[/S:ディレクトリ] [/B] [/H] [パス名 [&hellip;]]</p>

<p>CIPHER /K [/ECC:256|384|521]</p>

<p>CIPHER /R:ファイル名 [/SMARTCARD] [/ECC:256|384|521]</p>

<p>CIPHER /U [/N]</p>

<p>CIPHER /W:ディレクトリ</p>

<p>CIPHER /X[:EFS ファイル] [ファイル名]</p>

<p>CIPHER /Y</p>

<p>CIPHER /ADDUSER
[/CERTHASH:ハッシュ | /CERTFILE:ファイル名 | /USER:ユーザー名]
[/S:ディレクトリ] [/B] [/H] [パス名 [&hellip;]]</p>

<p>CIPHER /FLUSHCACHE [/SERVER:サーバー名]</p>

<p>CIPHER /REMOVEUSER /CERTHASH:ハッシュ
[/S:ディレクトリ] [/B] [/H] [パス名 [&hellip;]]</p>

<p>CIPHER /REKEY [パス名 [&hellip;]]</p>

<p>/B エラーが発生した場合に中断します。既定では、CIPHER は
エラーが発生しても実行を続行します。
/C 暗号化されたファイルに関する情報を表示します。
/D 指定されたファイルまたはディレクトリの暗号化を解除します。
/E 指定されたファイルまたはディレクトリを暗号化します。後で追加
されたファイルが暗号化されるようにディレクトリをマークします。
親ディレクトリが暗号化されていない場合、暗号化されたファイルは、
変更されるときに暗号化を解除されます。ファイルおよび親
ディレクトリを暗号化することをお勧めします。
/H 隠しファイルやシステム属性のファイルを表示します。既定では
これらのファイルは省略されます。
/K EFS で使用するための新しい証明書およびキーを作成します。
このオプションが指定されると、その他のオプションはすべて無視
されます。</p>

<p>注意: 既定では、/K によって現在のグループ ポリシーに準拠する
証明書とキーが作成されます。ECC が指定されている場合、
指定のキー サイズによる自己署名証明書が作成されます。</p>

<p>/N このオプションは /U を指定した場合にのみ動作します。
このオプションにより、キーが更新されなくなります。ローカル
ドライブ上のすべての暗号化ファイルを探すために使用されます。
/R EFS 回復キーと証明書を作成してから、それらを .PFX ファイル
(証明書と秘密キー) と .CER ファイル (証明書のみ) に書き込み
ます。管理者は、ユーザーの回復キーを作成するために .CER の内容
を EFS 回復ポリシーに追加し、個々のファイルを回復するために
.PFX ファイルをインポートすることができます。SMARTCARD
が指定されている場合は、回復キーと証明書をスマート カードに
書き込みます。.CER ファイルが生成されます (証明書のみ)。.PFX
ファイルは生成されません。</p>

<p>注意: 既定では、/R は 2048 ビット RSA 回復キーと証明書を作成しま
す。ECC が指定されている場合、その後にキー サイズ 256、384
または 521 が指定されている必要があります。</p>

<p>/S 指定されたディレクトリと、その下にあるすべてのファイルとサブ
ディレクトリに対して指定された操作を実行します。
/U ローカル ドライブのすべての暗号化ファイルを参照しようとします。
これにより、現在のユーザーのファイル暗号化キー、または回復キーに
変更があった場合、これらが更新されます。このオプションは /N 以外
の他のオプションでは動作しません。
/W ボリューム全体で利用可能な未使用のディスク領域から、データを削除
します。このオプションを選んだ場合は、他のオプションはすべて無視
されます。ローカル ボリューム上のどの場所にあるディレクトリでも
指定することができます。ディレクトリがマウント ポイントである
場合、または別のボリュームのディレクトリを指し示す場合は、その
ボリュームのデータが削除されます。
/X EFS 証明書とキーのバックアップを、指定された名前のファイルに
保存します。EFS ファイルが指定されている場合は、ファイルの暗号化
に使用されている現在のユーザーの証明書のバックアップが作成され
ます。指定されていない場合は、ユーザーの現在の EFS 証明書とキー
のバックアップが作成されます。
/Y ローカル PC 上の現在の EFS 証明書を縮小表示します。
/ADDUSER 指定された暗号化ファイルにユーザーを追加します。CERTHASH が指定
されている場合は、この SHA1 ハッシュを含む証明書が検索されます。
CERTFILE が指定されている場合は、ファイルから証明書が抽出
されます。USER が指定されている場合、CIPHER は Active Directory
ドメイン サービス内でユーザー証明書を検索します。
/FLUSHCACHE
指定されたサーバー上で、呼び出し元ユーザーの EFS キーのキャッシュ
をクリアします。サーバー名が指定されていない場合は、ローカル
コンピューター上の呼び出し元ユーザーのキー キャッシュがクリア
されます。
/REKEY 指定した暗号化ファイルを、構成済みの EFS の現在のキーを使用する
ように更新します。
/REMOVEUSER 指定されたファイルからユーザーを削除します。CERTHASH
は削除する証明書の SHA1 ハッシュである必要があります。</p>

<p>ディレクトリ ディレクトリのパスです。
ファイル名 拡張子を伴わないファイル名です。
パス名 パターン、ファイル、またはディレクトリを指定します。
EFS ファイル 暗号化されたファイルのパスです。</p>

<p>パラメーターを指定せずに CIPHER を実行すると、現在のディレクトリとディレクト
リに含まれるすべてのファイルの暗号化状態を表示します。複数のディレクトリ名
やワイルドカードを指定できます。複数のパラメーターを指定する場合は、パラ
メーターをスペースで区切ってください。```</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/batch" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">BATCH</a>
   </li>
  
   <li class="list">
     <a href="/tags/windows" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Windows</a>
   </li>
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3"></p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/2014-08-09-windows_freeotfe%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%8B%E3%81%9F/">[Windows] FreeOTFEの使いかた</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-08-08-windows_%E6%9A%97%E5%8F%B7%E5%8C%96%E4%BB%AE%E6%83%B3%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E7%AE%A1%E7%90%86%E3%83%84%E3%83%BC%E3%83%ABfreeotfe/">[Windows] 暗号化仮想ディスク管理ツールFreeOTFE</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-07-02-windows_%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E5%8F%96%E5%BE%97%E3%83%84%E3%83%BC%E3%83%ABscreenshoter%E3%81%AF%E3%83%96%E3%82%B5%E3%82%A4%E3%82%AF%E3%81%A0%E3%81%91%E3%81%A9%E6%A5%BD%E3%81%99%E3%81%8E%E3%82%8B/">[Windows] スクリーンショット取得ツールScreenshoterはブサイクだけど楽すぎる</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-06-20-%E3%83%A1%E3%83%A2windows_%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%A7ip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B/">[メモ][Windows] コマンドラインでIPアドレスを変更する</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-06-08-%E3%83%A1%E3%83%A2windows%E3%81%ABvagrant%E3%82%92%E5%85%A5%E3%82%8C%E3%81%A6%E3%81%BF%E3%81%9F/">[メモ]WindowsにVagrantを入れてみた</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-05-09-pyinstaller%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9Fwindows%E3%82%A2%E3%83%97%E3%83%AA%E3%81%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%95%E3%81%9B%E3%81%9F%E3%81%84version_resource_file%E3%81%AE%E4%BD%9C%E3%82%8A%E3%81%8B%E3%81%9F/">PyInstallerで作ったWindowsアプリでバージョンを表示させたい（Version Resource Fileの作りかた）</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-05-05-windows%E3%81%ABpyinstaller%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/">Windowsにpyinstallerをインストール</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-03-13-microsoft_security_essentials%E3%82%92%E3%83%90%E3%83%83%E3%83%81%E3%81%A7%E4%BD%BF%E3%81%8A%E3%81%86/">Microsoft Security Essentialsをバッチで使おう</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-03-06-%E3%83%A1%E3%83%A2_ms%E8%A3%BDoffice_2007%E4%BB%A5%E9%99%8D%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%83%93%E3%83%A5%E3%83%BC%E3%82%A2/">[メモ] MS製Office 2007以降ドキュメントビューア</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-02-27-windows%E3%81%AE%E3%82%AF%E3%83%AA%E3%83%83%E3%83%97%E3%83%9C%E3%83%BC%E3%83%89%E6%93%8D%E4%BD%9C%E7%B3%BB%E3%83%84%E3%83%BC%E3%83%AB/">Windowsのクリップボード操作系ツール</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-02-02-windows%E3%81%A7curl%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86%E3%81%82%E3%82%8B%E3%81%84%E3%81%AFmicrosoft_security_essential%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92curl%E3%81%A7%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89/">Windowsでcurlを使おう。あるいはMicrosoft Security Essentialの定義ファイルをcurlでダウンロード。</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2014-01-26-windows7%E3%81%A7samba%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E3%81%86%E3%81%BE%E3%81%8F%E9%96%8B%E3%81%91%E3%81%AA%E3%81%84%E4%BB%B6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6oplocks%E6%AD%BB%E3%81%99%E3%81%B9%E3%81%97/">Windows7でsambaのファイルがうまく開けない件について（oplocks死すべし）</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2013-12-27-python%E3%81%A7windows%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86/">PythonでWindowsアプリケーションを作ってみよう</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nobwak.github.io/" >
    &copy; 2019 Nobwak&#39;s Lair
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
