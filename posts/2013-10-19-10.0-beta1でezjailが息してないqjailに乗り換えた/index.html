<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Nobwak&#39;s Lair  | 10.0-BETA1でezjailが息してない→qjailに乗り換えた。</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.55.6" />
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="10.0-BETA1でezjailが息してない→qjailに乗り換えた。" />
<meta property="og:description" content="せっかく覚えたezjailが息してない jailの設定ファイルが、rc.conf,/etc/rc.d/jailからjail.confに変わる。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nobwak.github.io/posts/2013-10-19-10.0-beta1%E3%81%A7ezjail%E3%81%8C%E6%81%AF%E3%81%97%E3%81%A6%E3%81%AA%E3%81%84qjail%E3%81%AB%E4%B9%97%E3%82%8A%E6%8F%9B%E3%81%88%E3%81%9F/" />
<meta property="article:published_time" content="2013-10-19T20:48:00&#43;09:00"/>
<meta property="article:modified_time" content="2013-10-19T20:48:00&#43;09:00"/>

<meta itemprop="name" content="10.0-BETA1でezjailが息してない→qjailに乗り換えた。">
<meta itemprop="description" content="せっかく覚えたezjailが息してない jailの設定ファイルが、rc.conf,/etc/rc.d/jailからjail.confに変わる。">


<meta itemprop="datePublished" content="2013-10-19T20:48:00&#43;09:00" />
<meta itemprop="dateModified" content="2013-10-19T20:48:00&#43;09:00" />
<meta itemprop="wordCount" content="3625">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="10.0-BETA1でezjailが息してない→qjailに乗り換えた。"/>
<meta name="twitter:description" content="せっかく覚えたezjailが息してない jailの設定ファイルが、rc.conf,/etc/rc.d/jailからjail.confに変わる。"/>

      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-38155461-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://nobwak.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Nobwak&#39;s Lair
    </a>
    <div class="flex-l items-center">
      

      
      



<a href="https://twitter.com/nobwak" target="_blank" class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel="noopener" aria-label="follow on Twitter——Opens in a new window">
  <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>





<a href="nobwak" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>





    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">10.0-BETA1でezjailが息してない→qjailに乗り換えた。</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2013-10-19T20:48:00&#43;09:00">October 19, 2013</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<h2 id="span-style-text-decoration-underline-せっかく覚えたezjailが息してない-span"><span style="text-decoration: underline;">せっかく覚えたezjailが息してない</span></h2>

<p>jailの設定ファイルが、rc.conf,/etc/rc.d/jailからjail.confに変わる。</p>

<p><a href="https://twitter.com/m_bird/status/386369822751076352" target="_blank"><a href="https://twitter.com/m_bird/status/386369822751076352">https://twitter.com/m_bird/status/386369822751076352</a></a></p>

<p>そのせいか10.0-BETA1にしたら、ezjail使うたび怒られるようになった。<br />
具体的にはezjail-adminでjailをうまく起動できない。<br />
ezjail覚えたばっかなのに…。</p>

<p>「手動でなんとかしろよ」とエラーメッセージが出るのだが、jailの仕組みはとても複雑で、jail.confの書式も良くわからないしsampleもない。<br />
「rc.d, rc.confをそのままコピー&amp;ペーストしたらいいんだよ」とは言うのだけど、そもそもrc.d, rc.confを自分で書くのが嫌でezjail使ってたのに。</p>

<p>しょうがないんで、あんまり深く追いかけずに別のラッパーであるqjailを試した。</p>

<p>なかなか独特のテイストが感じられるのだが、思ったより手軽で、ドキュメントも（時にはウンザリするくらい）充実している。<br />
もちろんjail.confにも安心対応。</p>

<p>数十個ものjailを作ることも出来たり、一度作成したjailをテンプレートにする機能もあったりして驚く。</p>

<p>ググった感触でいうとあんまり人気ないみたいだけど、結構いい。<br />
細けえ事はどうでもいいからjailを使わせろという諸兄にはおすすめである。</p>

<h2 id="span-style-text-decoration-underline-qjailのインストール-span"><span style="text-decoration: underline;">qjailのインストール</span></h2>

<p>2013/10/18時点で2.2と3.2がある。<br />
jail.confに対応しているのは3.2。</p>

<p>話は前後するが、qjail3.2のman qjail(8)から抜粋すると;</p>

<blockquote>
<p>This version of qjail has been converted from using the legacy rc.d<br />
rc.conf method of jail definition as used in all pervious versions of<br />
qjail, to using the jail(8) jail.conf method which became available in<br />
9.1-RELEASE.</p>
</blockquote>

<p>よって3.2をインストール。<br />
なお、以下でqjailをインストールするFreeBSDは10.0-BETA1でございますので、pkgngを使います。</p>

<pre><code class="language-console">$ pkg search qjail
qjail-2.2
qjail-3.2
$ sudo pkg install qjail-3.2
Password:
Updating repository catalogue
The following 1 packages will be installed:

        Installing qjail: 3.2

The installation will require 416 KB more space

116 KB to be downloaded

Proceed with installing packages [y/N]: y
qjail-3.2.txz                       100%  116KB 115.9KB/s 115.9KB/s   00:01
Checking integrity... done
[1/1] Installing qjail-3.2... done
########################################################################
Use the qjail utility to deploy small or large numbers of jails quickly.

First issue &quot;rehash&quot; command to enable the qjail command (if using csh).
Then issue &quot;man qjail-intro&quot; to read the qjail introduction.
After reading that do &quot;man qjail&quot; for the usage details.
For the BIG PICTURE issue &quot;man qjail-howto&quot;.

########################################################################
For instructions on upgrading jail filesystems
Read /usr/local/share/examples/qjail/upgrade-info.txt
$
</code></pre>

<h2 id="span-style-text-decoration-underline-qjailでの初期設定-span"><span style="text-decoration: underline;">qjailでの初期設定</span></h2>

<p>まずはjailのひな形、ベース環境を作る。<br />
qjail installでよい。<br />
ひな形取得先のftpサーバを変更するならオプションで指定する。<br />
書式は以下。</p>

<pre><code class="language-console">qjail install -h ftp2.jp.freebsd.org
</code></pre>

<h2 id="span-style-text-decoration-underline-release以外でのqjail-install-span"><span style="text-decoration: underline;">RELEASE以外でのqjail install</span></h2>

<p>しかし、ftpサーバからダウンロードできるのはRELEASEのみ。<br />
BETA, RC, ALPHA, STABLE等々だとダメ。<br />
回避方法は二つ。</p>

<p>①なんでもいいのでRELEASEで作っておいてアップグレードする<br />
②ダウンロードしたディスクイメージを使う。</p>

<p>今回は②にした。<br />
①はman qjail参照。<br />
②をもう少し細かく書くと、ディスクイメージをマウントし、base.txzなどのある「ディレクトリ」をqjail install -fに続けて指定する。</p>

<p>「ディレクトリ」とわざわざ書いたのは、cdで行けるところ、というのを強調したかったから。<br />
ディスクイメージの直接指定はできないし、ftpサーバのディレクトリ指定もダメ。<br />
ガッカリ。</p>

<h2 id="span-style-text-decoration-underline-追記-release以外でのqjail-install-span"><span style="text-decoration: underline;">(追記)RELEASE以外でのqjail install</span></h2>

<p>「RELEASE以外」というのは、実はRELEASE-p2といったような、パッチレベルが0以外の場合も該当する。<br />
つまりfreebsd-updateでパッチを当てた状態でqjail installすると失敗する。<br />
これは、qjailは自ホストのOSバージョンをもとにディレクトリを移動するから。<br />
OSバージョンが10.1-RELEASE-p16だったら、ftpサーバの10.1-RELEASE-p16などを見に行ってしまう。<br />
しかし、ftpサーバはパッチレベルごとにはディレクトリが作られないので、参照先がなく失敗する。</p>

<p>ところで、ここでのOSバージョンとは、具体的には環境変数UNAME_rである。<br />
ということは、qjail installのときだけUNAME_rを変更すればパッチレベルが変わっていようがよいのである。<br />
以下、10.1-RELEASE-p16で実行した例。</p>

<pre><code class="language-console">root@kraken:/usr/local # setenv UNAME_r &quot;10.1-RELEASE&quot;
root@kraken:/usr/local # qjail install -h ftp2.jp.freebsd.org
Trying 202.232.140.170:21 ...
Connected to ftp.iij.ad.jp.
220 IIJ FTP server ready (IPv4 client).
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Switching to Binary mode.
250 Directory successfully changed.
local: base.txz remote: base.txz
229 Entering Extended Passive Mode (|||52115|).
150 Opening BINARY mode data connection for base.txz (66173780 bytes).
 85% |*****************************      | 54994 KiB  999.68 KiB/s    00:09 ETA
226 Transfer complete.
66173780 bytes received in 01:03 (0.99 MiB/s)
221 Goodbye.

The RELEASE distribution files are populating template.
Est LT 1 minute elapse time for this to complete.

Successfully installed qjail system.
</code></pre>

<p>追記ここまで</p>

<h2 id="span-style-text-decoration-underline-ダウンロードしたディスクイメージからqjail-install-span"><span style="text-decoration: underline;">ダウンロードしたディスクイメージからqjail install</span></h2>

<p>仕方がないので淡々と進める。<br />
10.0-BETA1のイメージダウンロードして、ローカルでマウント。</p>

<pre><code class="language-console">$ fetch ftp://ftp.iij.ad.jp/pub/FreeBSD/releases/ISO-IMAGES/10.0/FreeBSD-10.0-BETA1-amd64-disc1.iso
FreeBSD-10.0-BETA1-amd64-disc1.iso            100% of  693 MB 8138 kBps 01m27s
$
$ sudo mdconfig -a -t vnode -f ./FreeBSD-10.0-BETA1-amd64-disc1.iso -u 0
$ sudo mount -t cd9660 /dev/md0 /mnt
</code></pre>

<p>/mntにマウントしたとすると、/mnt/usr/freebsd-dist/が目的の場所。</p>

<pre><code class="language-console">$ ls /mnt
COPYRIGHT       etc             mnt             sbin            var
bin             lib             proc            sys
boot            libexec         rescue          tmp
dev             media           root            usr
$ ls /mnt/usr
bin             include         libdata         obj             src
freebsd-dist    lib             libexec         sbin            tests
games           lib32           local           share
$ ls /mnt/usr/freebsd-dist/
MANIFEST        doc.txz         kernel.txz      src.txz
base.txz        games.txz       lib32.txz
$
</code></pre>

<p>qjail install -fで実行。<br />
終わったらマウントも外そう。</p>

<pre><code class="language-console">$ sudo qjail install -f /mnt/usr/freebsd-dist/                  
The RELEASE distribution files are populating template.
Est LT 1 minute elapse time for this to complete.

sharedfs is being populated.
Est LT 1 minute elapse time for this to complete.

Successfully installed qjail system.
$
$ sudo umount /mnt
$ sudo mdconfig -d -u 0
</code></pre>

<h2 id="span-style-text-decoration-underline-qjailの構成-span"><span style="text-decoration: underline;">qjailの構成</span></h2>

<p>/usr/jailsにいくつかのディレクトリが生まれる。<br />
また、設定ファイルが/usr/local/etc/に格納される。</p>

<p>/usr/jails下は以下の通り。</p>

<pre><code class="language-console">$ ls /usr/jails
archive         flavors         sharedfs        template
</code></pre>

<p><span style="text-decoration: underline;">sharedfs:</span><br />
OSの実行ファイル、ライブラリ。全Jailで共有される。</p>

<pre><code class="language-console">$ ls /usr/jails/sharedfs/
bin     lib     libexec sbin    sys     usr
</code></pre>

<p><span style="text-decoration: underline;">template:</span><br />
OS configuration fileがある。設定変えようと思ったらここかな。</p>

<pre><code class="language-console">$ ls /usr/jails/template/
COPYRIGHT       home            mnt             sharedfs        var
bin             lib             proc            sys
dev             libexec         root            tmp
etc             media           sbin            usr
</code></pre>

<p><span style="text-decoration: underline;">archive:</span><br />
初期状態では空。<br />
qjail archiveコマンドで作成されるアーカイブが格納される。</p>

<p><span style="text-decoration: underline;">flavors:</span><br />
flavorですな。defaultとssh-defaultの二つがある。</p>

<pre><code class="language-console">$ ls /usr/jails/flavors/
default         ssh-default
</code></pre>

<p>そのほか、/usr/local/etc/下に以下のようなファイル、ディレクトリがたくさん出来る。<br />
jailを作ると今度はこのディレクトリの下にjail名でファイルができる。<br />
global, local, vnetの意味が、想像はできるもののよく分からない。</p>

<pre><code class="language-console">$ ls /usr/local/etc/qjail*
/usr/local/etc/qjail.portsnap.conf
/usr/local/etc/qjail.fstab:
/usr/local/etc/qjail.global:
/usr/local/etc/qjail.local:
/usr/local/etc/qjail.vnet:
</code></pre>

<h2 id="span-style-text-decoration-underline-jailの作成-span"><span style="text-decoration: underline;">jailの作成</span></h2>

<p>書式。代表的なもののみ。</p>

<pre><code class="language-console">qjail create -n &lt;NIC name&gt;  -f &lt;flavor&gt; -a &lt;アーカイブ&gt; \
 -4 &lt;割り当てるIPアドレス&gt;  jailname
</code></pre>

<p>-fと-aは一緒に使えない。</p>

<p>実際に作ってみる。<br />
あっさりと出来上がる。<br />
あっさりしすぎて逆に不安なくらい。</p>

<pre><code class="language-console">$ sudo qjail create -n em0 -4 192.168.100.240 example01
Successfully created  example01
</code></pre>

<p>気がつくと、/etc/jail.confが生まれている!</p>

<pre><code class="language-console">example01 {
host.hostname       =  &quot;exmaple01&quot;;
path                =  &quot;/usr/jails/exmaple01&quot;;
mount.fstab         =  &quot;/usr/local/etc/qjail.fstab/exmaple01&quot;;
exec.start          =  &quot;/bin/sh /etc/rc&quot;;
exec.stop           =  &quot;/bin/sh /etc/rc.shutdown&quot;;
exec.consolelog     =  &quot;/var/log/qjail.exmaple01.console.log&quot;;
devfs_ruleset       =  &quot;4&quot;;
allow.mount.devfs;
mount.devfs         =  &quot;1&quot;;
ip4.addr            =  192.168.100.240;
interface           =  &quot;em0&quot;;
}
</code></pre>

<p>jail起動…の前に、qjail listで確認。</p>

<h2 id="span-style-text-decoration-underline-qjail-list-span"><span style="text-decoration: underline;">qjail list</span></h2>

<p>作成済みのjailはqjail listで確認できる。</p>

<pre><code class="language-console">$ sudo qjail list
STA JID  NIC IP              Jailname
--- ---- --- --------------- --------------------------------------------------
DS  N/A  em0 192.168.100.240 example01
</code></pre>

<p>最初のカラムのSTAはStatusの略。</p>

<pre><code class="language-console">一文字め:Jailの種別
    D: ディレクトリベースのjail.
    I: イメージベースのjail.
二文字め:状態
    R: 実行中
    S: 停止中
</code></pre>

<p>JIDはjail IDのこと。そのほかは見たまま。</p>

<h2 id="span-style-text-decoration-underline-qjail-start-span"><span style="text-decoration: underline;">qjail start</span></h2>

<p>qjail startでjailを起動。<br />
qjail listの表示も変わり、ネットワークインタフェースへのaliasも実行してくれている。</p>

<pre><code class="language-console">$ sudo qjail start example01
Jail successfully started  example01
$
$ sudo qjail list
STA JID  NIC IP              Jailname
--- ---- --- --------------- --------------------------------------------------
DR  N/A  em0 192.168.100.240 example01

$ ifconfig em0
em0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=9b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM&gt;
        ether 08:00:27:a1:d7:05
        inet 192.168.100.110 netmask 0xffffff00 broadcast 192.168.100.255
        inet 192.168.100.240 netmask 0xffffffff broadcast 192.168.100.240
        nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;
        media: Ethernet autoselect (1000baseT &lt;full-duplex&gt;)
        status: active
</code></pre>

<h2 id="span-style-text-decoration-underline-qjail-consoleでjailの中へ-span"><span style="text-decoration: underline;">qjail consoleでjailの中へ</span></h2>

<p>qjail consoleでコンソールにアクセスできる。</p>

<pre><code class="language-console">$ sudo qjail console example01
FreeBSD 10.0-BETA1 (GENERIC) #0 r256420: Sun Oct 13 01:43:07 UTC 2013

Welcome to your FreeBSD jail.
example01 /root &gt;
</code></pre>

<p>特に何もしていないけど、/etc/localtimeと/etc/resolv.confは作ってくれた。wall_cmos_clockはなかった。</p>

<pre><code class="language-console">exmaple01 /root &gt;ls /etc | egrep &quot;resolv|clock|localtime&quot;
localtime
resolv.conf
</code></pre>

<h2 id="span-style-text-decoration-underline-qjail-stopで止めて-archiveでアーカイブ-deleteで削除完了-span"><span style="text-decoration: underline;">qjail stopで止めて、archiveでアーカイブ、deleteで削除完了</span></h2>

<p>単純にstopしてdeleteするのは面白くないから、deleteの前にarchiveしてみた。<br />
/usr/jails/archiveの下に<jail名>@日付秒.tarというファイルが出来ている。<br />
また、deleteしてもjail.confには記載が残っているようだ。</p>

<pre><code class="language-console">$ sudo qjail stop example01
Jail successfully stopped  example01
$ sudo qjail archive example01
Successfully archived example01
$ ls /usr/jails/archive/
example01@201310182327.36.tar
$ sudo qjail delete example01
Successfully deleted  example01
$ sudo qjail list
STA JID  NIC IP              Jailname
--- ---- --- --------------- --------------------------------------------------

$
$ cat /etc/jail.conf
example01 {
host.hostname       =  &quot;example01&quot;;
（後略）
</code></pre>

<h2 id="span-style-text-decoration-underline-qjail-restoreでarchive済みのjailを復活可能ッ-span"><span style="text-decoration: underline;">qjail restoreでarchive済みのjailを復活可能ッ！</span></h2>

<p>ためしにrestoreしてみたら何事もなかったかのように復活して驚いた。<br />
これはスナップショット的に使えますね。</p>

<pre><code class="language-console">$ sudo qjail restore example01
Successfully restored example01
$ sudo qjail list
STA JID  NIC IP              Jailname
--- ---- --- --------------- --------------------------------------------------
DS  N/A  em0 192.168.100.240 example01
$
$ sudo qjail start example01
Jail successfully started  example01
[vanilla@yaryka ~]$ sudo qjail console example01
Last login: Thu Oct 17 23:50:08 on pts/3
FreeBSD 10.0-BETA1 (GENERIC) #0 r256420: Sun Oct 13 01:43:07 UTC 2013

Welcome to your FreeBSD jail.
example01 /root &gt;
</code></pre>

<h2 id="span-style-text-decoration-underline-qjail-便利だよね-span"><span style="text-decoration: underline;">qjail、便利だよね？</span></h2>

<p>ご覧の通り、qjailはjailをマクロなレベルで扱うことに長けているようで、とても便利に感じる。<br />
qjailにはほかにもqjail configというコマンドがあり、既存のjailの設定（たとえばIPアドレスとか）を変えたりできるし、jailのOSアップデートも手軽にできるようだ。<br />
そのあたりはまた試すとして、しばらくjailはqjailでメンテしようと思った。</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nobwak.github.io/" >
    &copy; 2019 Nobwak&#39;s Lair
  </a>
    <div>


<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
width: 32px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: silver;">Share on: </span><div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https:\/\/nobwak.github.io\/\/categories\/git\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=https:\/\/nobwak.github.io\/\/categories\/git\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https:\/\/nobwak.github.io\/\/categories\/git\/&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>

<div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=https:\/\/nobwak.github.io\/\/categories\/git\/');"><svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>
<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/nobwak.github.io\/\/categories\/git\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div></div>
    <div>



<a href="https://twitter.com/nobwak" target="_blank" class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel="noopener" aria-label="follow on Twitter——Opens in a new window">
  <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>





<a href="nobwak" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
