<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Nobwak&#39;s Lair  | sha512でハッシュされたsaltつきパスワードを生成するには</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.54.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="sha512でハッシュされたsaltつきパスワードを生成するには" />
<meta property="og:description" content="バッチファイルにパスワードを書くときの悩み ユーザの追加や、属性の変更をバッチファイルで処理したいことがある。 しかしこういった作業には、しばし" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nobwak.github.io/posts/2013-09-07-sha512%E3%81%A7%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%81%95%E3%82%8C%E3%81%9Fsalt%E3%81%A4%E3%81%8D%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF/" />
<meta property="article:published_time" content="2013-09-07T21:34:46&#43;09:00"/>
<meta property="article:modified_time" content="2013-09-07T21:34:46&#43;09:00"/>

<meta itemprop="name" content="sha512でハッシュされたsaltつきパスワードを生成するには">
<meta itemprop="description" content="バッチファイルにパスワードを書くときの悩み ユーザの追加や、属性の変更をバッチファイルで処理したいことがある。 しかしこういった作業には、しばし">


<meta itemprop="datePublished" content="2013-09-07T21:34:46&#43;09:00" />
<meta itemprop="dateModified" content="2013-09-07T21:34:46&#43;09:00" />
<meta itemprop="wordCount" content="1136">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="sha512でハッシュされたsaltつきパスワードを生成するには"/>
<meta name="twitter:description" content="バッチファイルにパスワードを書くときの悩み ユーザの追加や、属性の変更をバッチファイルで処理したいことがある。 しかしこういった作業には、しばし"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://nobwak.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Nobwak&#39;s Lair
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">sha512でハッシュされたsaltつきパスワードを生成するには</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2013-09-07T21:34:46&#43;09:00">September 7, 2013</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<h2 id="span-style-text-decoration-underline-バッチファイルにパスワードを書くときの悩み-span"><span style="text-decoration: underline;">バッチファイルにパスワードを書くときの悩み</span></h2>

<p>ユーザの追加や、属性の変更をバッチファイルで処理したいことがある。<br />
しかしこういった作業には、しばしばパスワードの操作が含まれる。<br />
しかしパスワードを平文のまま扱うわけにもいかない。<br />
パスワードの設定・変更をするコマンドが、暗号化されたパスワードも受け付けるようになっているのは、そのためだ。</p>

<p>たとえばLinuxには<a href="http://linuxjm.sourceforge.jp/html/shadow/man8/chpasswd.8.html" target="_blank">chpasswd</a>というコマンドがある。chpasswdは暗号化されたパスワードを受け付ける。<br />
もしバッチファイルを覗かれても、パスワードが暗号化されていれば、まあ大丈夫と言える。</p>

<h2 id="span-style-text-decoration-underline-md5からsha512へ-span"><span style="text-decoration: underline;">MD5からSHA512へ</span></h2>

<p>ところで、<a href="../../../?p=1839">こちらの記事</a>でも触れたとおり、MD5は今そこにある危機であるからして、パスワードのハッシュ方法をSHA512に変えるOSもぼちぼち出てきた。<br />
そういったOSにおいて、暗号化したパスワードでユーザ情報の操作をするには、とうぜんパスワードをSHA512で暗号化しなければならない。</p>

<p>ということで、ある文字列をSHA512暗号化する方法を示す。</p>

<h2 id="span-style-text-decoration-underline-パスワードの書式での暗号化-span"><span style="text-decoration: underline;">パスワードの書式での暗号化</span></h2>

<p>SHA512で暗号化だなんていうのは簡単なのだが、しかし、パスワードファイルで使われる形式での暗号化となると、ちょっと工夫が必要だ。</p>

<p>パスワードファイルの形式は以下の通り。</p>

<pre><code class="language-console">$＜ハッシュ方式＞$＜salt＞$＜ハッシュ後のパスワード＞
</code></pre>

<p>要するにこういう形式での出力をしてくれるコマンドなりスクリプトでなければならない。<br />
代表的なものでは、opensslコマンド。</p>

<h2 id="span-style-text-decoration-underline-opensslコマンドのつかいかた-span"><span style="text-decoration: underline;">Opensslコマンドのつかいかた</span></h2>

<p>openssl passwdという書式で使う。</p>

<pre><code class="language-console">$ openssl version
OpenSSL 0.9.8y 5 Feb 2013
＜中略＞
Usage: passwd [options] [passwords]
where options are
-crypt             standard Unix password algorithm (default)
-1                 MD5-based password algorithm
-apr1              MD5-based password algorithm, Apache variant
-salt string       use provided salt
-in file           read passwords from file
-stdin             read passwords from stdin
-noverify          never verify when reading password from terminal
-quiet             no warnings
-table             format output as table
-reverse           switch table columns
</code></pre>

<p>だからたとえば、MD5形式で、saltを&rdquo;SALTsalt&rdquo;とし、パスワードを&rdquo;test&rdquo;とするならば、 以下のようにする。</p>

<pre><code class="language-console">$ openssl passwd -1 -salt &quot;SALTsalt&quot; &quot;test&quot;
$1$SALTsalt$CEvzkj.qgOcLTyU2B5Kg3.
</code></pre>

<p>しかし上述のオプション一覧を見ると分かるのだが、sha512形式には対応していない。</p>

<h2 id="span-style-text-decoration-underline-sha512は-いまならperlとかpython-span"><span style="text-decoration: underline;">SHA512は…いまならperlとかpython</span></h2>

<p>ここまで引っ張ってナニだが、一発でSHA512ハッシュしてくれるコマンドは見つけられなかった。<br />
Linuxのmkpasswdも新しければ対応しているようなのだがまだ一般的ではない。<br />
そこでperl, pythonを使う。<br />
以下のようにする。</p>

<p>saltを&rdquo;SALTsalt&rdquo;とし、パスワードを&rdquo;test&rdquo;とする。</p>

<p>perl</p>

<pre><code class="language-console">$ perl -e 'print crypt(&quot;test&quot;, &quot;\$6\$SALTsalt&quot;);'
$6$SALTsalt$gH47I0mRGadJVVlIpeTxVlYw.SjkPOZ7lJoGkqOyhyeUJ7PV5QWuYpIG6D5ggew6RXLpl1eA72TpgX5pGDpr/.
</code></pre>

<p>python</p>

<pre><code class="language-console">$ python -c &quot;import crypt, getpass, pwd; print crypt.crypt('test','\$6\$SALTsalt\$')&quot;
$6$SALTsalt$gH47I0mRGadJVVlIpeTxVlYw.SjkPOZ7lJoGkqOyhyeUJ7PV5QWuYpIG6D5ggew6RXLpl1eA72TpgX5pGDpr/.
</code></pre>

<p>FreeBSDにおける実際の使いどころは以下の記事にて。</p>

<p><a href="../../../?p=2214">[FreeBSD] 無人でのユーザ追加</a></p>

<p>おしまい。</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nobwak.github.io/" >
    &copy; 2019 Nobwak&#39;s Lair
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
